# 拉普拉斯算子

在计算机图形学中，曲面表达与处理一直是热门话题，它牵扯到几何建模、辅助设计等诸多重要应用。网格作为一种最流行的分段线性曲面表示方法，能够近似地表达原光滑曲面。在本章节中，我们将介绍网格的微分属性，它是根据某些定义在网格上的线性算子得出的，这些算子通常是网格的拉普拉斯算子的变体，提供了各种方便曲面表示与处理等应用的基础。相较于传统的被用来表达点坐标的全局笛卡尔坐标，微分曲面表达承载着曲面局部形态、局部细节的尺寸及方向等重要几何信息。对这些信息的定义可以方便我们更好地控制、处理几何问题，本章讲详细介绍拉普拉斯算子，微分表达及曲面重建等问题。

本文中，我们用$M = (V,E,F)$来表达一个给定的三角网格，$V,E,F$分别表示网格中的顶点集合、边集合及面集合，顶点数量记为$n$。每个顶点$i \in M$可以用笛卡尔坐标表示其空间中的绝对位置$v_i=(x_i,y_i,z_i)$，并且用$N(i)$来表示顶点$v_i$的1-ring邻域。

## 连续拉普拉斯算子

**拉普拉斯算子 (Laplacian Operator)**是欧氏空间中的一个二阶微分算子，定义为函数的梯度的散度。对于二元函数，其在欧氏空间上的拉普拉斯算子可以写为

$\Delta f = div \nabla f = div (f_u, f_v) = f_{uu}+f_{vv}$

拉普拉斯算子可以被推广到二阶流形曲面$S$上，称为**拉普拉斯-贝尔特拉米算子 (Laplace-Beltrami Operator)**，定义为

$\Delta _Sf = div_S\nabla _Sf$

除此之外，在微分几何中，对于曲面上某一点$x$，其Laplace-Beltrami operator与该点处的**平均曲率 (Mean Curvature)**存在如下关系：

$\Delta _Sx = -2Hn$

其中，$H$表示该点处的平均曲率，$n$为法向。

**微分坐标 (Differential Coordinates)** 是一个重要概念，它在连续的光滑曲面上的定义为

$\frac{1}{len(\gamma)}\int_{v\in \gamma} (v_j - v)ds$

### 连续拉普拉斯算子的性质

1.  **NULL：**由于拉普拉斯算子为函数的梯度的散度，那么说明当函数$f$是常数时，$\Delta f = 0$。
2.  **对称性 (SYM) :** 边上的权重是对称的 。
3.  **局部性 (LOC) :** 对于任意一对$p \not = q$点，$ \Delta f(p)$与$ \Delta f(q)$无关。
4.  **线性性 (LIN) :** 如果曲面$S$是平面并且$f$是线性的，那么$\Delta f = 0$。
5.  **最大值原则 (MAX) :** 调和函数在内部点上没有局部最大值。
6.  **半正定性 (PSD) :** 拉普拉斯算子构造的矩阵是半正定的，Dirichlet能量是非负的。

## 离散拉普拉斯算子

在离散微分几何中，它是一个定义在顶点上的向量，描述了三维模型的局部信息，即包含了顶点与周围顶点之间的相对关系。假定网格$M$是光滑曲面的分段线性近似，那么微分坐标$\delta$可以被视作是连续Laplace-Beltrami算子的离散版本。需要注意的是，**光滑曲面的拉普拉斯算子是唯一的**，而离散化的形式有很多种，但是没有任何一种拉普拉斯算子能够同时满足光滑拉普拉斯算子的所有性质，换句话说，不同的离散拉普拉斯算子会保留不同的连续拉普拉斯算子的性质，**通常我们需要针对不同的三维模型操作来选取满足不同性质的拉普拉斯算子以追求更准确的计算结果。**拉普拉斯算子常用于网格滤波、网格参数化、曲面重建、Remeshing、基于重心坐标的插值等问题。

### 离散拉普拉斯算子的性质

*   **NULL：**由于拉普拉斯算子为函数的梯度的散度，那么说明当函数$f$是常数时，$\Delta f = 0$。
*   **对称性 (SYM) : 当$w_{ij} = w_{ji}$时，对称性成立。**如果将权重$w$构造成矩阵，那么这个矩阵是一个实矩阵，有着实特征值和正交的特征向量。
*   **局部性 (LOC) : 当权重作用在边上时，局部性成立。**也就是说，当$(i,j) \not\in E$时，$w_{ij} = 0$。
*   **线性性 (LIN) :** **当$0=(Lx)_i = \sum_{j \in N(i)} w_{ij}(x_i-x_j)$时，线性性成立。**
*   **正权性 (POS) : 当**$w_{ij}>0$**时，正权性成立。**正权性是最大值原则的充分条件。
*   **半正定性 (PSD) :** **当$L$是半正定时，半正定性成立。满足对称性和正权性时，一定满足半正定性，但是半正定性不一定满足正权性。**

下面将讨论两个不同版本的Laplace-Beltrami算子：**均值拉普拉斯 (Uniform Laplacian)** 和**余切拉普拉斯 (Cotangent Laplacian)**。

### 均值拉普拉斯

首先定义微分坐标（$\delta$坐标），它是点$v_i$的绝对坐标与它相邻点求得的重心的差，如图1所示，均值拉普拉斯在顶点$v_i$处的微分坐标定义为

$\delta _i = \frac{1}{d_i}\sum_{j\in N(i)}(v_i-v_j)$

![image](https://upload-images.jianshu.io/upload_images/19551947-43b9088cdf5576df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

此处，$N(i)$表示点$v_i$的邻域集合，$j$为与点$v_i$相邻的点的索引，因此$(i,j)$构成了一条边，即N(i) = {j|(i,j)\in E}，$d_i$表示邻域集合$N(i)$的数量，也就是顶点的**度(Degree or Valence)** 。根据公式不难看出，均值拉普拉斯对连续拉普拉斯的逼近程度不是很好，因为它没有考虑曲面的几何性质，仅仅考虑了顶点之间的连接关系，它只适用于各三角形网格尺寸较接近的网格，过大或过小的三角形面片会使该算子对连续拉普拉斯的逼近误差扩大。

### 余切拉普拉斯

余切拉普拉斯定义的微分坐标是一个位于顶点处的**向量**，其**法向与顶点法向朝向一致，大小与顶点的平均曲率一致**。需要注意的是它不是旋转不变的，当模型被旋转时，微分坐标的法向会随着模型旋转而改变（大小不变）。这意味着从欧式坐标转换到微分坐标是非线性的，会给后续的计算带来麻烦。

![余切拉普拉斯算子](https://upload-images.jianshu.io/upload_images/19551947-4cdf213962803c38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/400) 

相比于均值拉普拉斯，余切拉普拉斯拥有更高的精度，它可以通过混合有限元/有限体积方法得到 [Meyer et al. 03]。其目标是在局部平均区域上对分段线性函数的梯度的散度进行积分：

$\delta _i = \frac{1}{2A_i}\sum_{j\in N(i)}(cot \alpha_{ij} + cot \beta_{ij})(v_i-v_j)$

其中，$A_i$表示顶点$v_i$的**局部平均面积 (Local Averaging Area)**，它被用来计算一个点的邻域的积分量，与离散算子的精度和稳定性密切相关，通常有Barycentric cell、Voronoi cell 及 MixedVoronoi cell 三种计算方式，如图3所示，这里通常采用Voronoi cell来计算。$\alpha_{ij}$和$\beta_{ij}$分别表示的是与边$(i,j)$相对的两个角，详细的公式推导可参阅《Polygon Mesh Processing》第三章节的内容。

![Local Averaging Area](https://upload-images.jianshu.io/upload_images/19551947-e3e512802451beca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/400) 

余切拉普拉斯算子在数字几何处理种非常常见，因为它反映了网格的几何性质，但有时也有一定的局限性，因为其权重可能为负。观察其余切权重$(cot \alpha_{ij} + cot \beta_{ij})$，当三角形为钝角三角形时，$\alpha_{ij}+\beta _{ij}$的值可能大于$\pi$，此时$(cot \alpha_{ij} + cot \beta_{ij})<0$，当权重为负值时，不满足半正定性，计算上会带来相应的麻烦。

## 拉普拉斯矩阵

矩阵既可以表示离散的三维模型上的点、边、面的邻接关系，也可以表示像拉普拉斯算子这样的基本操作符。如果在三维模型上的各顶点处定义一个数值，这些数值的集合即可构成一个离散的函数，使用拉普拉斯算子构造的矩阵可以将这个数值组成的集合映射成为另一个数值集合。例如，对于一个具有$V$个顶点的模型$M$，如果在每一个顶点$v$处定义一个维数为$V$的函数$F$，那么就能构成一个$V×V$的拉普拉斯矩阵$L$，对该模型上的离散函数$F$执行拉普拉斯操作其实就是令拉普拉斯矩阵$L$与向量$F$ 相乘，然后得到另一个维数为$V$的向量。拉普拉斯矩阵在不相邻两顶点之间的元素处为零，因此该矩阵是一个稀疏矩阵，每行平均只有6个非零值。拉普拉斯矩阵每一行的一般定义为：

$(Lf) = b_i^{-1} \sum_{j \in N(j)} w_{ij}(f_i-f_j)$

拉普拉斯矩阵通常分为两大类，**组合拉普拉斯矩阵**和**几何拉普拉斯矩阵**。组合拉普拉斯矩阵仅考虑三维模型的拓扑信息，几何拉普拉斯矩阵既考虑拓扑信息还加入了几何信息。值得注意的是，上文提到的均值拉普拉斯算子构造的矩阵属于组合拉普拉斯矩阵，而余切拉普拉斯算子构造的矩阵属于几何拉普拉斯矩阵，下文还会继续提到。

### 图形拉普拉斯矩阵

**图形拉普拉斯矩阵 (Graph Laplacian Matrix)** 是一种**组合拉普拉斯矩阵**，因此它的构造不考虑每个顶点的位置、三角形的面积、边长，只考虑顶点的连接关系。

首先我们定义网格的**邻接矩阵 (Adjacency Matrix)** ：

$A_{ij} = \begin{cases} 1 \quad (i,j) \in E \\ 0 \quad otherwise \end{cases}$

并且，我们使用顶点的度来定义网格的**对角矩阵 (Diagonal Matrix)** ：

$D_{ij} = \begin{cases} d_i \quad i=j \\ 0 \quad otherwise \end{cases}$

通过上述两个矩阵的构造，我们可以得到，即$L=D-A$。由于图形拉普拉斯矩阵的代数性质能够关联它所代表的图的组合性质，并且是一个半正定矩阵，因此早已在代数与图论领域被广泛研究。

$L_{ij} = \begin{cases} -1 \quad (i,j) \in E \\ d_i \quad i=j \\ 0 \quad otherwise \end{cases}$

![图形拉普拉斯矩阵](https://upload-images.jianshu.io/upload_images/19551947-482414e9f93bc77e?imageMogr2/auto-orient/strip%7CimageView2/2/w/400) 

### 余切拉普拉斯矩阵

余切拉普拉斯矩阵也称为**拉普拉斯-贝尔特拉米矩阵 (Laplace-Beltrami Matrix)**，顾名思义，它是利用余切拉普拉斯算子的权重来构造矩阵的。构造方法为：

$L_{ij} = \begin{cases} w_{ij} = \frac{1}{2} (cot \alpha_{ij} + cot \beta_{ij}) \quad (i,j) \in E \\ \sum_{j \in N(j)} -w_{ij} \quad i=j \\ 0 \quad otherwise \end{cases}$

![余切拉普拉斯矩阵](https://upload-images.jianshu.io/upload_images/19551947-a38361eed1b3b0c5?imageMogr2/auto-orient/strip%7CimageView2/2/w/400) 

## References

[1] Meyer, M., Desbrun, M., Schröder, P. and Barr, A.H., 2003\. Discrete differential-geometry operators for triangulated 2-manifolds. In *Visualization and mathematics III* (pp. 35-57). Springer, Berlin, Heidelberg.

[2] Botsch, M., Kobbelt, L., Pauly, M., Alliez, P. and Lévy, B., 2010\. *Polygon mesh processing*. CRC press.

[3] Sorkine, O., 2005\. Laplacian mesh processing. *Eurographics (STARs)*, *29*.